{% extends "base.html" %}
{% block title %}Services · Admin · ScheduleBooker{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="page-wrap">
    <div class="admin-toolbar">
        <div>
            <h1 class="admin-title">Services</h1>
            <p class="admin-subtitle">Edit name, price, duration, category, and visibility.</p>
        </div>

        <div class="admin-toolbar-right">
            <a class="btn btn-outline" href="{{ url_for('admin.day') }}">Back to Calendar</a>
            <a class="btn" href="{{ url_for('admin.services_new') }}">+ New Service</a>
        </div>
    </div>

    {% if error %}
    <div class="services-alert">{{ error }}</div>
    {% endif %}

    <div class="table-card services-card">
        <div class="services-card-header">
            <h3 style="margin:0;">Active services</h3>
            <span class="muted">Shown to customers</span>
        </div>

        <div class="services-table-scroll">
            <table class="services-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>Duration</th>
                        <th>Price</th>
                        <th>Popular</th>
                        <th>Order</th>
                        <th class="services-th-actions">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in active_services %}
                    <tr>
                        <td class="services-td-strong">{{ s.name }}</td>
                        <td><span class="pill">{{ s.category }}</span></td>
                        <td>{{ s.duration_min }} min</td>
                        <td>
                            {% if s.price_is_from %}From {% endif %}
                            {{ "%.2f"|format(s.price) }}
                            {% if s.price_label %}
                            <span class="small">({{ s.price_label }})</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if s.is_popular %}
                            <span class="pill ok">Yes</span>
                            {% else %}
                            <span class="pill bad">No</span>
                            {% endif %}
                        </td>
                        <td>{{ s.sort_order }}</td>
                        <td>
                            <div class="services-actions">
                                <a class="btn btn-outline" href="{{ url_for('admin.services_edit', service_id=s.id) }}">
                                    Edit
                                </a>

                                <form class="services-inline-form" method="post"
                                    action="{{ url_for('admin.services_hide', service_id=s.id) }}">
                                    <button class="btn btn-outline btn-danger" type="submit"
                                        onclick="return confirm('Hide this service? It will disappear from the customer list. Past bookings will show the new name automatically.')">
                                        Hide
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="muted">No active services.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <details class="services-details">
        <summary class="btn btn-outline services-toggle">
            Hidden services ({{ hidden_services|length }})
        </summary>

        <div class="table-card services-card" style="margin-top:12px;">
            <div class="services-card-header">
                <h3 style="margin:0;">Hidden services</h3>
                <span class="muted">Not shown to customers</span>
            </div>

            <div class="services-table-scroll">
                <table class="services-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Duration</th>
                            <th>Price</th>
                            <th>Popular</th>
                            <th>Order</th>
                            <th class="services-th-actions">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for s in hidden_services %}
                        <tr>
                            <td class="services-td-strong">
                                {{ s.name }} <span class="pill bad" style="margin-left:8px;">Hidden</span>
                            </td>
                            <td><span class="pill">{{ s.category }}</span></td>
                            <td>{{ s.duration_min }} min</td>
                            <td>
                                {% if s.price_is_from %}From {% endif %}
                                {{ "%.2f"|format(s.price) }}
                                {% if s.price_label %}
                                <span class="small">({{ s.price_label }})</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if s.is_popular %}
                                <span class="pill ok">Yes</span>
                                {% else %}
                                <span class="pill bad">No</span>
                                {% endif %}
                            </td>
                            <td>{{ s.sort_order }}</td>
                            <td>
                                <div class="services-actions">
                                    <a class="btn btn-outline"
                                        href="{{ url_for('admin.services_edit', service_id=s.id) }}">
                                        Edit
                                    </a>

                                    <form class="services-inline-form" method="post"
                                        action="{{ url_for('admin.services_restore', service_id=s.id) }}">
                                        <button class="btn" type="submit">Restore</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="7" class="muted">No hidden services.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </details>
</div>
{% endblock %}