{% extends "base.html" %}
{% block content %}
<h1>Pick a time</h1>

<div class="card">
  <div class="row row-between">
    <div>
      <div class="title">{{ service.name }}</div>
      <div class="subtle">
        {% if service.duration_min %}{{ service.duration_min }} min{% endif %}
        {% if service.price is not none %} Â· ${{ service.price }}{% endif %}
      </div>
    </div>
    <a class="btn btn-ghost" href="/services">Change service</a>
  </div>
</div>

<h2 style="margin-top:18px">1) Choose date and barber</h2>
<form class="card form" method="get" action="/book">
  <input type="hidden" name="service_id" value="{{ service.id }}">

  <div class="grid-2">
    <label class="field">
      <span>Date</span>
      <input type="date" name="date" value="{{ selected_date or '' }}">
    </label>

    <label class="field">
      <span>Barber</span>
      <select name="barber_id">
        <option value="" {% if not selected_barber_id %}selected{% endif %}>Any barber</option>
        {% for b in barbers %}
          <option value="{{ b.id }}" {% if selected_barber_id == b.id %}selected{% endif %}>{{ b.name }}</option>
        {% endfor %}
      </select>
    </label>
  </div>

  <div class="row" style="margin-top:12px">
    <button class="btn" type="submit">Update availability</button>
  </div>
</form>

<h2 style="margin-top:18px">2) Select a time</h2>
<form class="card form" method="post" action="/book/confirm">
  <input type="hidden" name="service_id" value="{{ service.id }}">
  <input type="hidden" name="date" value="{{ selected_date or '' }}">
  <input type="hidden" name="barber_id" value="{{ selected_barber_id or '' }}">

  {% if time_slots %}
    <div class="slots">
      {% for s in time_slots %}
        {% set slot_id = 'slot_' ~ loop.index %}
        <label class="slot {% if not s.is_available %}slot-disabled{% endif %}">
          <input
            type="radio"
            name="time"
            value="{{ s.time }}"
            {% if not s.is_available %}disabled{% endif %}
            required
          >
          <span class="slot-time">{{ s.time }}</span>
          {% if not s.is_available and s.reason %}
            <span class="slot-reason">{{ s.reason }}</span>
          {% endif %}
        </label>
      {% endfor %}
    </div>

    <div class="row" style="margin-top:12px">
      <button class="btn" type="submit">Continue</button>
      <a class="btn btn-ghost" href="/services">Back</a>
    </div>
  {% else %}
    <div class="alert">No time slots available for the selected options.</div>
  {% endif %}
</form>
{% endblock %}
